<div class="vorspann"><img class="rteInlinetag" src="https://heise-cms.de//image/icon_inline.gif" title="<ir_inline itemname=bilder_mvp_bild_var2:1 type=1>" style="max-height: 25px; max-width: 25px;">In diesem Artikel werde ich die Regeln für Deklarationen abschließen. Die verbleibenden Regeln sind nicht besonders anspruchsvoll aber sehr wichtig für guten Code.</div>
<div class="text">Und schon geht es weiter. Hier ist der erste Überblick zu den Regeln, bevor wir in die Details eintauchen.&nbsp;</div>
<div class="text"><ul><li><a title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-const" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-const" alt="%7B%22ir_link%22%3A1%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-const%22%2C%22type%22%3A%22E%22%2C%22subject%22%3A%22%22%2C%22text%22%3A%22ES.25%3A%20Declare%20an%20object%26nbsp%3Bconst%26nbsp%3Bor%26nbsp%3Bconstexpr%26nbsp%3Bunless%20you%20want%20to%20modify%20its%20value%20later%20on%22%2C%22user_params%22%3A%22%22%2C%22version%22%3A1%2C%22anchor%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-const%22%7D" class="">ES.25: Declare an object&nbsp;const&nbsp;or&nbsp;constexpr&nbsp;unless you want to modify its value later on</a></li><li> <a alt="%7B%22text%22%3A%22ES.26%3A%20Don%C2%92t%20use%20a%20variable%20for%20two%20unrelated%20purposes%22%2C%22subject%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-recycle%22%2C%22ir_link%22%3A1%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-recycle%22%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22anchor%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22version%22%3A1%7D" class="" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-recycle" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-recycle">ES.26: Don’t use a variable for two unrelated purposes</a> </li><li><a alt="%7B%22ir_link%22%3A1%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-recycle%22%2C%22text%22%3A%22ES.27%3A%20Use%26nbsp%3Bstd%3A%3Aarray%26nbsp%3Bor%26nbsp%3Bstack_array%26nbsp%3Bfor%20arrays%20on%20the%20stack%22%2C%22subject%22%3A%22%22%2C%22anchor%22%3A%22%22%2C%22version%22%3A1%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-recycle%22%7D" class="" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-recycle" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-recycle">ES.27: Use&nbsp;std::array&nbsp;or&nbsp;stack_array&nbsp;for arrays on the stack</a></li><li><a href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-stack" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-stack" class="" alt="%7B%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-stack%22%2C%22type%22%3A%22E%22%2C%22ir_link%22%3A1%2C%22subject%22%3A%22%22%2C%22text%22%3A%22ES.28%3A%20Use%20lambdas%20for%20complex%20initialization%2C%20especially%20of%26nbsp%3Bconst%26nbsp%3Bvariables%22%2C%22target%22%3A%22_blank%22%2C%22alias%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22version%22%3A1%2C%22user_params%22%3A%22%22%2C%22anchor%22%3A%22%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-stack%22%7D">ES.28: Use lambdas for complex initialization, especially of&nbsp;const&nbsp;variables</a></li><li> <a title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-macros" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-macros" class="" alt="%7B%22text%22%3A%22ES.30%3A%20Don%C2%92t%20use%20macros%20for%20program%20text%20manipulation%22%2C%22subject%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-macros%22%2C%22ir_link%22%3A1%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-macros%22%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22anchor%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22version%22%3A1%7D">ES.30: Don’t use macros for program text manipulation</a> </li><li> <a title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-macros2" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-macros2" alt="%7B%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-macros2%22%2C%22ir_link%22%3A1%2C%22text%22%3A%22ES.31%3A%20Don%C2%92t%20use%20macros%20for%20constants%20or%20%C2%93functions%C2%94%22%2C%22subject%22%3A%22%22%2C%22alias%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22target%22%3A%22_blank%22%2C%22anchor%22%3A%22%22%2C%22version%22%3A1%2C%22user_params%22%3A%22%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-macros2%22%7D" class="">ES.31: Don’t use macros for constants or “functions”</a> </li><li><a title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-ALL_CAPS" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-ALL_CAPS" alt="%7B%22subject%22%3A%22%22%2C%22text%22%3A%22ES.32%3A%20Use%26nbsp%3BALL_CAPS%26nbsp%3Bfor%26nbsp%3Ball%20macro%20names%22%2C%22ir_link%22%3A1%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-ALL_CAPS%22%2C%22type%22%3A%22E%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-ALL_CAPS%22%2C%22user_params%22%3A%22%22%2C%22version%22%3A1%2C%22anchor%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%7D" class="">ES.32: Use&nbsp;ALL_CAPS&nbsp;for&nbsp;all macro names</a></li><li> <a href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-MACROS" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-MACROS" alt="%7B%22subject%22%3A%22%22%2C%22text%22%3A%22ES.33%3A%20If%20you%20must%20use%20macros%2C%20give%20them%20unique%20names%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-MACROS%22%2C%22type%22%3A%22E%22%2C%22ir_link%22%3A1%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-MACROS%22%2C%22target%22%3A%22_blank%22%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22version%22%3A1%2C%22anchor%22%3A%22%22%7D" class="">ES.33: If you must use macros, give them unique names</a> </li><li> <a href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-ellipses" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-ellipses" class="" alt="%7B%22target%22%3A%22_blank%22%2C%22alias%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22user_params%22%3A%22%22%2C%22version%22%3A1%2C%22anchor%22%3A%22%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-ellipses%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-ellipses%22%2C%22type%22%3A%22E%22%2C%22ir_link%22%3A1%2C%22subject%22%3A%22%22%2C%22text%22%3A%22ES.34%3A%20Don%C2%92t%20define%20a%20%28C-style%29%20variadic%20function%22%7D">ES.34: Don’t define a (C-style) variadic function</a></li></ul></div>
<div class="text">In Python gibt es einen beliebten Aphorismus des Zen von Python (Tim Peters): "Explicit is betten than implicit." Dieser stellt eine Meta-Regel für das Schreibe von gutem Code in Python dar. Genau diese Meta-Regel trifft auch auf die ersten zwei vorgestellten Regeln der C++ Core Guidelines zu.</div>
<div class="text"><b><a title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-const" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-const" class="" alt="%7B%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-const%22%2C%22target%22%3A%22_blank%22%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%2C%22version%22%3A1%2C%22user_params%22%3A%22%22%2C%22anchor%22%3A%22%22%2C%22subject%22%3A%22%22%2C%22text%22%3A%22ES.25%3A%20Declare%20an%20object%26nbsp%3Bconst%26nbsp%3Bor%26nbsp%3Bconstexpr%26nbsp%3Bunless%20you%20want%20to%20modify%20its%20value%20later%20on%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-const%22%2C%22type%22%3A%22E%22%2C%22ir_link%22%3A1%7D">ES.25: Declare an object&nbsp;const&nbsp;or&nbsp;constexpr&nbsp;unless you want to modify its value later on</a></b></div>
<div class="text">Warum sollten <i>const </i>oder <i>constexpr</i> für Variablen-Deklarationen verwendet werden? Ich kenne viele gute Gründe:</div>
<div class="text"><ul><li>Du bringst deine Absicht genau auf den Punkt.</li><li>Deine Variable kann nicht zufällig verändert werden.</li><li><i>const</i>- oder&nbsp;<i>constexpr</i>-Variablen sind per Definition thread-sicher.</li><ul><li><i>const</i>: Du musst lediglich sicherstellen, dass die Variable thread-sicher initialisiert wird.</li><li><i>constexpr</i>: Die C++-Laufzeit sichert zu, dass die Variable thread-sicher initialisiert wird.</li></ul></ul></div>
<div class="text"><b><a alt="%7B%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-recycle%22%2C%22ir_link%22%3A1%2C%22text%22%3A%22ES.26%3A%20Don%C2%92t%20use%20a%20variable%20for%20two%20unrelated%20purposes%22%2C%22subject%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22anchor%22%3A%22%22%2C%22version%22%3A1%2C%22user_params%22%3A%22%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-recycle%22%7D" class="" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-recycle" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-recycle">ES.26: Don’t use a variable for two unrelated purposes</a></b><br></div>
<div class="text">Ist dies guter Code?</div>
<div class="pre">void use()<br>{<br>&nbsp;&nbsp;&nbsp; int i;<br>&nbsp;&nbsp;&nbsp; for (i = 0; i &lt; 20; ++i) { /* ... */ }<br>&nbsp;&nbsp;&nbsp; for (i = 0; i &lt; 200; ++i) { /* ... */ } // bad: i recycled<br>}<br></div>
<div class="text">Ich denke nicht. Verschiebe die Deklaration von <i>i </i>in die <i>for</i>-Schleife. Damit wird die Gültigkeit von <i>i </i>an die Gültigkeit der <i>for</i>-Schleife gebunden.</div>
<div class="pre">void use()<br>{<br>&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; 20; ++i) { /* ... */ }<br>&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; 200; ++i) { /* ... */ } <br>}<br></div>
<div class="text">Mit C++17 lässt sich eine Variable direkt in einer <i>switch</i>- oder einer <i>if-</i>Anweisung deklarieren: "<a alt="%7B%22destination%22%3A%22http%3A%2F%2Fwww.grimm-jaud.de%2Findex.php%2Fblog%2Fc-17-kern%22%2C%22alias%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22target%22%3A%22_blank%22%2C%22anchor%22%3A%22%22%2C%22version%22%3A1%2C%22user_params%22%3A%22%22%2C%22text%22%3A%22C%2B%2B17%3A%20Was%20gibt%27s%20Neues%20in%20der%20Kernsprache%3F%22%2C%22subject%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fwww.grimm-jaud.de%2Findex.php%2Fblog%2Fc-17-kern%22%2C%22ir_link%22%3A1%7D" class="" href="http://www.grimm-jaud.de/index.php/blog/c-17-kern" title="Link auf http://www.grimm-jaud.de/index.php/blog/c-17-kern">C++17: Was gibt's Neues in der Kernsprache?</a>"</div>
<div class="text"><b><a alt="%7B%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-recycle%22%2C%22anchor%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22version%22%3A1%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22text%22%3A%22ES.27%3A%20Use%26nbsp%3Bstd%3A%3Aarray%26nbsp%3Bor%26nbsp%3Bstack_array%26nbsp%3Bfor%20arrays%20on%20the%20stack%22%2C%22subject%22%3A%22%22%2C%22ir_link%22%3A1%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-recycle%22%7D" class="" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-recycle" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-recycle">ES.27: Use&nbsp;std::array&nbsp;or&nbsp;stack_array&nbsp;for arrays on the stack</a></b><br></div>
<div class="text">Vor gut Zehn Jahren ist es mir selbst passiert. Ich dachte, dass das Anlegen eines Arrays variabler Länge ISO C++ darstellt.<br></div>
<div class="pre">const int n = 7;<br>int m = 9;<br><br>void f()<br>{<br>&nbsp;&nbsp;&nbsp; int a1[n];<br>&nbsp;&nbsp;&nbsp; int a2[m];&nbsp;&nbsp; // error: not ISO C++<br>&nbsp;&nbsp;&nbsp; // ...<br>}<br></div>
<div class="text">Falsch! </div>
<div class="text">Im ersten Fall solltest du ein <i>std::array</i> anwenden und im zweiten Fall ein <i>gsl::stack_array </i>aus der <a alt="%7B%22subject%22%3A%22%22%2C%22text%22%3A%22Guideline%20Support%20Library%20%28GSL%29.%22%2C%22ir_link%22%3A1%2C%22href%22%3A%22https%3A%2F%2Fgithub.com%2FMicrosoft%2FGSL%22%2C%22type%22%3A%22E%22%2C%22destination%22%3A%22https%3A%2F%2Fgithub.com%2FMicrosoft%2FGSL%22%2C%22version%22%3A1%2C%22user_params%22%3A%22%22%2C%22anchor%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22alias%22%3A%22%22%2C%22custom%22%3A%7B%7D%7D" class="" title="Link auf https://github.com/Microsoft/GSL" href="https://github.com/Microsoft/GSL">Guideline Support Library (GSL).</a> <br></div>
<div class="pre">const int n = 7;<br>int m = 9;<br><br>void f()<br>{<br>&nbsp;&nbsp;&nbsp; std::array&lt;int, n&gt; b1;<br>&nbsp;&nbsp;&nbsp; gsl::stack_array&lt;int&gt; b2(m);<br>&nbsp;&nbsp;&nbsp; // ...<br>}<br></div>
<div class="text">Warum sollte ein <i>std::array</i> statt eines C-Arrays, ein <i>gsl::stack_array</i> statt eines C-Arrays eingesetzt werden?</div>
<div class="text"><i>std::array</i> kennt im Gegensatz zum C-Array seine Länge und wird nicht zum Zeiger auf sein erstes Element degradiert, wenn es als Parameter einer Funktion verwendet wird. Wie leicht ist es, die folgenden Funktion zum Kopieren von C-Arrays mit der falschen Länge <i>n</i> aufzurufen:</div>
<div class="pre">void copy_n(const T* p, T* q, int n); // copy from [p:p+n) to [q:q+n)</div>
<div class="text">Arrays variabler Länge wie <i>a2[m]</i> stellen ein Sicherheitsrisiko dar, da sie es erlauben können, beliebigen Code auszuführen oder den Stack zu konsumieren.</div>
<div class="text"><b><a alt="%7B%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-stack%22%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22anchor%22%3A%22%22%2C%22version%22%3A1%2C%22user_params%22%3A%22%22%2C%22text%22%3A%22ES.28%3A%20Use%20lambdas%20for%20complex%20initialization%2C%20especially%20of%26nbsp%3Bconst%26nbsp%3Bvariables%22%2C%22subject%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-stack%22%2C%22ir_link%22%3A1%7D" class="" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-stack" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-stack">ES.28: Use lambdas for complex initialization, especially of&nbsp;const&nbsp;variables</a></b><br></div>
<div class="text">Immer wieder kommt die Frage in meinen Seminaren auf: Warum soll ich eine Lambda-Funktion direkt an Ort und Stelle aufrufen? Diese Regel gibt eine Antwort. In ihr lässt sich die aufwendige Initialisierung schön verpacken. Dieser Aufruf an Ort und Stelle ist sehr wichtig, wenn der Wert <i>const</i> werden soll. </div>
<div class="text">Falls du einen Wert nach seiner Initialisierung nicht mehr verändern willst, solltest du ihn entsprechend der vorherigen Regel R.25 <i>const</i> deklarieren. Gut! Aber manchmal wird eine Variable mehrstufig initialisiert. Daher kann sie nicht als <i>const</i> deklariert werden. </div>
<div class="text">Das <i>widget x</i> in dem folgenden Beispiel sollte nach seiner Initialisierung konstant sein. Das lässt die C++-Syntax aber nicht zu, da<i> x</i> während seiner Initialisierung mehrfach verändert wird. <br></div>
<div class="pre">widget x;&nbsp;&nbsp; // should be const, but:<br>for (auto i = 2; i &lt;= N; ++i) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // this could be some<br>&nbsp;&nbsp;&nbsp; x += some_obj.do_something_with(i);&nbsp; // arbitrarily long code<br>}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // needed to initialize x<br>// from here, x should be const, but we can't say so in code in this style<br></div>
<div class="text">Die Rettung naht in der Gestalt einer Lambda-Funktion. Schiebe die Initialisierung der Variable in eine Lambda-Funktion, binde die Umgebung per Referenz und initialisiere deine konstante Variable mit einer an Ort und Stelle aufgerufenen Lambda-Funktion. <br></div>
<div class="pre">const widget x = [&amp;]{<br>&nbsp;&nbsp;&nbsp; widget val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // widget has a default constructor<br>&nbsp;&nbsp;&nbsp; for (auto i = 2; i &lt;= N; ++i) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // this could be some<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; val += some_obj.do_something_with(i);&nbsp; // arbitrarily long code<br>&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // needed to initialize x<br>&nbsp;&nbsp;&nbsp; return val;<br>}();<br></div>
<div class="text">Zugegeben, es sieht schon ein wenig befremdlich aus, eine Lambda-Funktion an Ort und Stelle aufzurufen. Vom konzeptionellen Blickwinkel betrachtet, ist es sehr elegant. Der ganze Initialisierungsaufwand ist schön in einem Funktionskörper verpackt.</div>
<div class="text"><b><a class="" alt="%7B%22text%22%3A%22ES.30%22%2C%22subject%22%3A%22%22%2C%22ir_link%22%3A1%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-macros%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-macros%22%2C%22anchor%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22version%22%3A1%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%2C%22target%22%3A%22_blank%22%7D" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-macros" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-macros">ES.30</a>, <a alt="%7B%22subject%22%3A%22%22%2C%22text%22%3A%22%20ES.31%22%2C%22ir_link%22%3A1%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-macros2%22%2C%22type%22%3A%22E%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-macros2%22%2C%22version%22%3A1%2C%22user_params%22%3A%22%22%2C%22anchor%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%7D" class="" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-macros2" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-macros2"> ES.31</a>, <a class="" alt="%7B%22ir_link%22%3A1%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-ALL_CAPS%22%2C%22type%22%3A%22E%22%2C%22subject%22%3A%22%22%2C%22text%22%3A%22ES.32%22%2C%22version%22%3A1%2C%22user_params%22%3A%22%22%2C%22anchor%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-ALL_CAPS%22%7D" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-ALL_CAPS" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-ALL_CAPS">ES.32</a> und <a class="" alt="%7B%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-MACROS%22%2C%22alias%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22target%22%3A%22_blank%22%2C%22anchor%22%3A%22%22%2C%22version%22%3A1%2C%22user_params%22%3A%22%22%2C%22text%22%3A%22ES.33%22%2C%22subject%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-MACROS%22%2C%22ir_link%22%3A1%7D" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-MACROS" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-MACROS">ES.33</a></b></div>
<div class="text">Diese vier Regeln werde ich nur kurz zusammenfassen. Verwende keine Makros für Textmanipulationen oder für Konstanten und Funktionen. Falls du Makros verwenden musst, gib ihnen eindeutige Namen in GROSS_BUCHSTABEN.<br></div>
<div class="text"><b><a href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-ellipses" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-ellipses" class="" alt="%7B%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-ellipses%22%2C%22target%22%3A%22_blank%22%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22version%22%3A1%2C%22anchor%22%3A%22%22%2C%22subject%22%3A%22%22%2C%22text%22%3A%22ES.34%3A%20Don%C2%92t%20define%20a%20%28C-style%29%20variadic%20function%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Res-ellipses%22%2C%22type%22%3A%22E%22%2C%22ir_link%22%3A1%7D">ES.34: Don’t define a (C-style) variadic function</a></b></div>
<div class="text">Genau! Verwende keine C-Style-Variadic-Funktionen! Seit C++11 besitzen wir <a href="http://en.cppreference.com/w/cpp/language/parameter_pack" title="Link auf http://en.cppreference.com/w/cpp/language/parameter_pack" class="" alt="%7B%22alias%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22target%22%3A%22_blank%22%2C%22anchor%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22version%22%3A1%2C%22destination%22%3A%22http%3A%2F%2Fen.cppreference.com%2Fw%2Fcpp%2Flanguage%2Fparameter_pack%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fen.cppreference.com%2Fw%2Fcpp%2Flanguage%2Fparameter_pack%22%2C%22ir_link%22%3A1%2C%22text%22%3A%22Variadic%20Templates%22%2C%22subject%22%3A%22%22%7D">Variadic Templates</a> und mit C++17 <a class="" alt="%7B%22destination%22%3A%22http%3A%2F%2Fwww.grimm-jaud.de%2Findex.php%2F44-blog%2Ffunktional%2F190-fold-expressions%22%2C%22target%22%3A%22_blank%22%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%2C%22version%22%3A1%2C%22user_params%22%3A%22%22%2C%22anchor%22%3A%22%22%2C%22subject%22%3A%22%22%2C%22text%22%3A%22Fold%20Expressions%22%2C%22href%22%3A%22http%3A%2F%2Fwww.grimm-jaud.de%2Findex.php%2F44-blog%2Ffunktional%2F190-fold-expressions%22%2C%22type%22%3A%22E%22%2C%22ir_link%22%3A1%7D" title="Link auf http://www.grimm-jaud.de/index.php/44-blog/funktional/190-fold-expressions" href="http://www.grimm-jaud.de/index.php/44-blog/funktional/190-fold-expressions">Fold Expressions</a>. Das ist alles, was wir benötigen. </div>
<div class="text">Du hast sicherlich bereits sehr oft die C-Style-Variadi-Funktion <i>printf</i> verwendet. <i>printf</i> nimmt einen Fomat-String und eine beliebige Anzahl an Argument an und stellt diese dar. Ein Aufruf von <i>printf</i> besitzt undefiniertes Verhalten, falls du die falschen Formatangaben verwendest oder die Anzahl der Argumente nicht passt. </div>
<div class="text">Dank Variadic Templates lässt sich eine typsichere <i>printf</i>-Funktion implementieren. Hier ist eine vereinfachte Variante von <i>printf,</i> basierend auf <a alt="%7B%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fen.cppreference.com%2Fw%2Fcpp%2Flanguage%2Fparameter_pack%22%2C%22ir_link%22%3A1%2C%22text%22%3A%22cppreference.com%22%2C%22subject%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22alias%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22anchor%22%3A%22%22%2C%22version%22%3A1%2C%22user_params%22%3A%22%22%2C%22destination%22%3A%22http%3A%2F%2Fen.cppreference.com%2Fw%2Fcpp%2Flanguage%2Fparameter_pack%22%7D" class="" href="http://en.cppreference.com/w/cpp/language/parameter_pack" title="Link auf http://en.cppreference.com/w/cpp/language/parameter_pack">cppreference.com</a>. <br></div>
<div class="pre">// myPrintf.cpp<br><br>#include &lt;iostream&gt;<br>&nbsp;<br>void myPrintf(const char* format){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // (1)<br>&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; format;<br>}<br>&nbsp;<br>template&lt;typename T, typename... Targs&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // (2)<br>void myPrintf(const char* format, T value, Targs... Fargs) <br>{<br>&nbsp;&nbsp;&nbsp; for ( ; *format != '\0'; format++ ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( *format == '%' ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; value;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // (3)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myPrintf(format+1, Fargs...);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // (4)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; *format;<br>&nbsp;&nbsp;&nbsp; }<br>}<br>&nbsp;<br>int main(){<br>&nbsp;&nbsp;&nbsp; myPrintf("% world% %\n","Hello",'!',123);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Hello world! 123<br>}<br></div>
<div class="text"><i>myPrintf </i>kann eine beliebige Anzahl an Elementen annehmen. Falls beliebig 0 bedeutet, wird die erste überladene Variante (1) von <i>printf</i> verwendet. Falls beliebig mehr als 0 bedeutet, wird die zweite Variante (2) verwendet. Das Funktions-Template (2) ist sehr interessant. Es kann eine beliebige Anzahl an Argumenten annehmen, solange diese größer als 0 ist. Das erste Argument wird an <i>value </i>gebunden und auf <i>std::cout</i> (3) geschrieben. Die verbleibenden Argumente werden in (4) verwendet, um einen rekursiven Aufruf (4) zu starten. Diese Rekursion erzeugt ein neues Funktions-Template <i>myPrintf,</i> das genau ein Argument weniger erwartet. Diese Rekursion geht gegen 0. Falls 0 eintritt, kommt als Abbruchbedingung die Funktion <i>myPrintf</i> (1) zum Zuge.</div>
<div class="text"><i> <img class="rteInlinetag" src="https://heise-cms.de/image/rte/textbox.svg" title="<ir_inline itemname=textboxen_mvp_text:1 type=3>" style="max-height: 25px; max-width: 25px;">myPrintf</i> ist typsicher, da die ganze Ausgabe von <i>std::cout</i> erledigt wird. Diese vereinfachte Variante unterstützt keine Formatangaben wie <i>%d, %f </i>oder<i> %5.5f.</i></div>
<div class="ztitel">Wie geht's weiter?</div>
<div class="text">Es gibt viel über Ausdrücke zu erzählen. Die C++ Core Guidelines besitzt mehr als 25 Regeln für sie.</div>
