<div class="vorspann"><img class="rteInlinetag" src="https://heise-cms.de/thumbs//TN_141857803_352e4bca9a.png" title="<ir_inline itemname=bilder_mvp_bild_var2:1 type=1>" style="max-height: 25px; max-width: 25px;"><br> </div>
<div class="vorspann">Ein Blog-Beitrag zu Vergleichen und die wichtigen Funktionen swap und hash. Damit endet die Tour zu Regeln in den Guidelines, die sich mit den Default-Operationen befassen.</div>
<div class="text">Hier sind die neun Regeln:</div>
<div class="text"><ul><li> <a title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-eqdefault" alt="%7B%22type%22%3A%22E%22%2C%22alias%22%3A%22%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-eqdefault%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-eqdefault%22%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22subject%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22version%22%3A1%2C%22ir_link%22%3A1%2C%22text%22%3A%22C.80%3A%20Use%20%3Ddefault%20if%20you%20have%20to%20be%20explicit%20about%20using%20the%20default%20semantics%22%2C%22anchor%22%3A%22%22%7D" class="" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-eqdefault">C.80: Use =default if you have to be explicit about using the default semantics</a> <br></li><li> <a class="" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-delete" alt="%7B%22anchor%22%3A%22%22%2C%22text%22%3A%22C.81%3A%20Use%20%3Ddelete%20when%20you%20want%20to%20disable%20default%20behavior%20%28without%20wanting%20an%20alternative%29%22%2C%22ir_link%22%3A1%2C%22version%22%3A1%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-delete%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-delete%22%2C%22alias%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22target%22%3A%22_blank%22%2C%22subject%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22user_params%22%3A%22%22%7D" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-delete">C.81: Use =delete when you want to disable default behavior (without wanting an alternative)</a> <br></li><li> <a title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-ctor-virtual" class="" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-ctor-virtual" alt="%7B%22version%22%3A1%2C%22anchor%22%3A%22%22%2C%22ir_link%22%3A1%2C%22text%22%3A%22C.82%3A%20Don%C2%92t%20call%20virtual%20functions%20in%20constructors%20and%20destructors%22%2C%22subject%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22user_params%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-ctor-virtual%22%2C%22alias%22%3A%22%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-ctor-virtual%22%7D">C.82: Don’t call virtual functions in constructors and destructors</a> <br></li><li> <a title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-swap" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-swap" class="" alt="%7B%22anchor%22%3A%22%22%2C%22text%22%3A%22C.83%3A%20For%20value-like%20types%2C%20consider%20providing%20a%20noexcept%20swap%20function%22%2C%22ir_link%22%3A1%2C%22version%22%3A1%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-swap%22%2C%22alias%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-swap%22%2C%22target%22%3A%22_blank%22%2C%22subject%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%7D">C.83: For value-like types, consider providing a noexcept swap function</a> <br></li><li> <a title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-swap-fail" alt="%7B%22version%22%3A1%2C%22text%22%3A%22C.84%3A%20A%20swap%20may%20not%20fail%22%2C%22ir_link%22%3A1%2C%22anchor%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22alias%22%3A%22%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-swap-fail%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-swap-fail%22%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22subject%22%3A%22%22%2C%22target%22%3A%22_blank%22%7D" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-swap-fail" class="">C.84: A swap may not fail</a> <br></li><li> <a class="" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-swap-noexcept" alt="%7B%22target%22%3A%22_blank%22%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22subject%22%3A%22%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-swap-noexcept%22%2C%22alias%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-swap-noexcept%22%2C%22ir_link%22%3A1%2C%22text%22%3A%22C.85%3A%20Make%20swap%20noexcept%22%2C%22anchor%22%3A%22%22%2C%22version%22%3A1%7D" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-swap-noexcept">C.85: Make swap noexcept</a> <br></li><li> <a alt="%7B%22text%22%3A%22C.86%3A%20Make%20%3D%3D%20symmetric%20with%20respect%20of%20operand%20types%20and%20noexcept%22%2C%22ir_link%22%3A1%2C%22anchor%22%3A%22%22%2C%22version%22%3A1%2C%22target%22%3A%22_blank%22%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22subject%22%3A%22%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-eq%22%2C%22alias%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-eq%22%7D" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-eq" class="" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-eq">C.86: Make == symmetric with respect of operand types and noexcept</a> <br></li><li> <a title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-eq-base" alt="%7B%22version%22%3A1%2C%22ir_link%22%3A1%2C%22text%22%3A%22C.87%3A%20Beware%20of%20%3D%3D%20on%20base%20classes%22%2C%22anchor%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22subject%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-eq-base%22%2C%22alias%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-eq-base%22%7D" class="" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-eq-base">C.87: Beware of == on base classes</a> <br></li><li><a title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-hash" alt="%7B%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-hash%22%2C%22alias%22%3A%22%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-hash%22%2C%22type%22%3A%22E%22%2C%22target%22%3A%22_blank%22%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22subject%22%3A%22%22%2C%22text%22%3A%22C.89%3A%20Make%20a%20hash%20noexcept%22%2C%22ir_link%22%3A1%2C%22anchor%22%3A%22%22%2C%22version%22%3A1%7D" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-hash" class="">C.89: Make a hash noexcept</a></li></ul></div>
<div class="ztitel">Regeln zu Default-Operationen:</div>
<div class="text"><b><a alt="%7B%22target%22%3A%22_blank%22%2C%22subject%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22user_params%22%3A%22%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-eqdefault%22%2C%22alias%22%3A%22%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-eqdefault%22%2C%22type%22%3A%22E%22%2C%22anchor%22%3A%22%22%2C%22text%22%3A%22C.80%3A%20Use%20%3Ddefault%20if%20you%20have%20to%20be%20explicit%20about%20using%20the%20default%20semantics%22%2C%22ir_link%22%3A1%2C%22version%22%3A1%7D" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-eqdefault" class="" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-eqdefault">C.80: Use =default if you have to be explicit about using the default semantics</a></b></div>
<div class="text">Die <a title="Link auf https://www.heise.de/developer/artikel/C-Core-Guidelines-Die-Nuller-Fuenfer-oder-Sechserregel-3813435.html" alt="%7B%22version%22%3A1%2C%22anchor%22%3A%22%22%2C%22text%22%3A%22F%C3%BCnferregel%22%2C%22ir_link%22%3A1%2C%22subject%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22target%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22alias%22%3A%22%22%2C%22href%22%3A%22https%3A%2F%2Fwww.heise.de%2Fdeveloper%2Fartikel%2FC-Core-Guidelines-Die-Nuller-Fuenfer-oder-Sechserregel-3813435.html%22%2C%22destination%22%3A%22https%3A%2F%2Fwww.heise.de%2Fdeveloper%2Fartikel%2FC-Core-Guidelines-Die-Nuller-Fuenfer-oder-Sechserregel-3813435.html%22%7D" class="" href="https://www.heise.de/developer/artikel/C-Core-Guidelines-Die-Nuller-Fuenfer-oder-Sechserregel-3813435.html">Fünferregel</a> besagt, dass man beim Implementieren einer der speziellen fünf Regeln alle fünf implementieren sollte. Hier kommt der entscheidende Punkt: Falls ich den Destruktor wie im folgenden Beispiel implementiere, sollte ich auch den Copy- und Move-Konstruktor und den Copy- und Move-Zuweisungsoperator zur Verfügung stellen.</div>
<div class="pre">class Tracer {<br>&nbsp;&nbsp;&nbsp; string message;<br>public:<br>&nbsp;&nbsp;&nbsp; Tracer(const string&amp; m) : message{m} { cerr &lt;&lt; "entering " &lt;&lt; message &lt;&lt; '\n'; }<br>&nbsp;&nbsp;&nbsp; ~Tracer() { cerr &lt;&lt; "exiting " &lt;&lt; message &lt;&lt; '\n'; }<br><br>&nbsp;&nbsp;&nbsp; Tracer(const Tracer&amp;) = default;<br>&nbsp;&nbsp;&nbsp; Tracer&amp; operator=(const Tracer&amp;) = default;<br>&nbsp;&nbsp;&nbsp; Tracer(Tracer&amp;&amp;) = default;<br>&nbsp;&nbsp;&nbsp; Tracer&amp; operator=(Tracer&amp;&amp;) = default;<br>};</div>
<div class="text">Die C++-Laufzeit hat die ganze Arbeit erledigt. Aber ich kann auch selber Hand anlegen. Das ist im besten Fall langweilig, im schlechtesten fehlerhaft.</div>
<div class="pre">class Tracer2 {<br>&nbsp;&nbsp;&nbsp; string message;<br>public:<br>&nbsp;&nbsp;&nbsp; Tracer2(const string&amp; m) : message{m} { cerr &lt;&lt; "entering " &lt;&lt; message &lt;&lt; '\n'; }<br>&nbsp;&nbsp;&nbsp; ~Tracer2() { cerr &lt;&lt; "exiting " &lt;&lt; message &lt;&lt; '\n'; }<br><br>&nbsp;&nbsp;&nbsp; Tracer2(const Tracer2&amp; a) : message{a.message} {}<br>&nbsp;&nbsp;&nbsp; Tracer2&amp; operator=(const Tracer2&amp; a) { message = a.message; return *this; }<br>&nbsp;&nbsp;&nbsp; Tracer2(Tracer2&amp;&amp; a) :message{a.message} {}<br>&nbsp;&nbsp;&nbsp; Tracer2&amp; operator=(Tracer2&amp;&amp; a) { message = a.message; return *this; }<br>};<br> </div>
<div class="text"><b><a href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-delete" class="" alt="%7B%22version%22%3A1%2C%22text%22%3A%22C.81%3A%20Use%20%3Ddelete%20when%20you%20want%20to%20disable%20default%20behavior%20%28without%20wanting%20an%20alternative%29%22%2C%22ir_link%22%3A1%2C%22anchor%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22subject%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-delete%22%2C%22alias%22%3A%22%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-delete%22%7D" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-delete">C.81: Use =delete when you want to disable default behavior (without wanting an alternative)</a></b></div>
<div class="text">Gelegentlich sind die Methoden nicht erwünscht, die die C++-Laufzeit automatisch erzeugt. Hier kommt <i>delete</i> ins Spiel. <i>delete</i> wird sehr häufig in der Standard Library eingesetzt. So ist der Copy-Konstruktor von Datentypen wie Locks, Mutexe, Promises oder Futures auf <i>delete</i> gesetzt. Dasselbe gilt für den Smart Pointer<i> std::unique_ptr: std::unique_ptr(const std::unique_ptr&amp;) = delete. </i></div>
<div class="text"><i>delete</i> kann natürlich auch dazu verwendet werden, seltsame Datentypen zu erzeugen. Instanzen von<i> Immortal </i>lassen sich nicht löschen. </div>
<div class="pre">class Immortal {<br>public:<br>&nbsp;&nbsp;&nbsp; ~Immortal() = delete;&nbsp;&nbsp; // do not allow destruction<br>&nbsp;&nbsp;&nbsp; // ...<br>};<br><br>void use()<br>{<br>&nbsp;&nbsp;&nbsp; Immortal ugh;&nbsp;&nbsp; // error: ugh cannot be destroyed<br>&nbsp;&nbsp;&nbsp; Immortal* p = new Immortal{};<br>&nbsp;&nbsp;&nbsp; delete p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // error: cannot destroy *p<br>}</div>
<div class="text"><b><a alt="%7B%22version%22%3A1%2C%22text%22%3A%22C.82%3A%20Don%27t%20call%20virtual%20functions%20in%20constructors%20and%20destructors%22%2C%22ir_link%22%3A1%2C%22anchor%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22subject%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-ctor-virtual%22%2C%22alias%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-ctor-virtual%22%7D" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-ctor-virtual" class="" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-ctor-virtual">C.82: Don't call virtual functions in constructors and destructors</a></b></div>
<div class="text">Diese Regel ist der Regel <a title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-factory" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-factory" class="" alt="%7B%22anchor%22%3A%22%22%2C%22text%22%3A%22C.50%3A%20Use%20a%20factory%20function%20if%20you%20need%20%5C%22virtual%20behavior%5C%22%20during%20initialization%22%2C%22ir_link%22%3A1%2C%22version%22%3A1%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-factory%22%2C%22type%22%3A%22E%22%2C%22alias%22%3A%22%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-factory%22%2C%22target%22%3A%22_blank%22%2C%22subject%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%7D">C.50: Use a factory function if you need "virtual behavior" during initialization</a>, die ich in dem Artikel <a title="Link auf http://www.modernescpp.com/index.php/c-core-guidelines-constructors" alt="%7B%22anchor%22%3A%22%22%2C%22text%22%3A%22%5C%22C%2B%2B%20Core%20Guidelines%3A%20Konstruktoren%22%2C%22ir_link%22%3A1%2C%22version%22%3A1%2C%22destination%22%3A%22http%3A%2F%2Fwww.modernescpp.com%2Findex.php%2Fc-core-guidelines-constructors%22%2C%22type%22%3A%22E%22%2C%22alias%22%3A%22%22%2C%22href%22%3A%22http%3A%2F%2Fwww.modernescpp.com%2Findex.php%2Fc-core-guidelines-constructors%22%2C%22target%22%3A%22_blank%22%2C%22subject%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%7D" class="" href="http://www.modernescpp.com/index.php/c-core-guidelines-constructors">"C++ Core Guidelines: Konstruktoren</a>" vorstellte, sehe ähnlich.<br></div>
<div class="text">Bei den nächsten drei Regeln dreht sich alles um swap-Funktionen. Daher werde ich sie in einem Rutsch behandeln.<br></div>
<div class="text"><b><a class="" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-swap" alt="%7B%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22subject%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22alias%22%3A%22%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-swap%22%2C%22type%22%3A%22E%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-swap%22%2C%22version%22%3A1%2C%22text%22%3A%22C.83%3A%20For%20value-like%20types%2C%20consider%20providing%20a%20noexcept%20swap%20function%2C%26nbsp%3B%22%2C%22ir_link%22%3A1%2C%22anchor%22%3A%22%22%7D" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-swap">C.83: For value-like types, consider providing a noexcept swap function,&nbsp;</a> <a title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-swap-fail" alt="%7B%22version%22%3A1%2C%22anchor%22%3A%22%22%2C%22text%22%3A%22C.84%3A%20A%20swap%20may%20not%20fail%2C%22%2C%22ir_link%22%3A1%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-swap-fail%22%2C%22alias%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-swap-fail%22%2C%22subject%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22user_params%22%3A%22%22%2C%22target%22%3A%22_blank%22%7D" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-swap-fail" class="">C.84: A swap may not fail,</a> and<a href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-swap-noexcept" class="" alt="%7B%22text%22%3A%22%20C.85%3A%20Make%20swap%20noexcept%22%2C%22ir_link%22%3A1%2C%22anchor%22%3A%22%22%2C%22version%22%3A1%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-swap-noexcept%22%2C%22alias%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-swap-noexcept%22%2C%22target%22%3A%22_blank%22%2C%22custom%22%3A%7B%7D%2C%22user_params%22%3A%22%22%2C%22subject%22%3A%22%22%7D" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-swap-noexcept"> C.85: Make swap noexcept</a></b></div>
<div class="text">Eine <i>swap</i>-Funktion ist ziemlich praktisch:</div>
<div class="pre">template&lt; typename T &gt;<br>void std::swap(T &amp; a, T &amp; b) noexcept {<br>&nbsp;&nbsp;&nbsp; T tmp(std::move(a));<br>&nbsp;&nbsp;&nbsp; a = std::move(b);<br>&nbsp;&nbsp;&nbsp; b = std::move(tmp);<br>}<br></div>
<div class="text">Der C++-Standard bietet mehr als 40 Spezialisierungen der <i>std::swap-</i>Funktion an. Man kann sie als elementare Bausteine für viele C++-Idiome wie den Copy- und Move-Zuweisungsoperator verwenden. Eine <i>swap</i>-Funktion soll keine Ausnahme werfen. Daher sollte sie als <i>noexcept</i> deklariert werden.<br></div>
<div class="text">Das folgende Beispiel zeigt einen Move-Zuweisungsoperator, der <i>std:.swap</i> verwendet. [i]pdate[/i] zeigt auf ein Array:<br></div>
<div class="pre">class Cont{&nbsp;&nbsp;&nbsp;&nbsp; <br>public:<br>&nbsp; Cont&amp; operator=(Cont&amp;&amp; rhs);<br>&nbsp;<br>private:<br>&nbsp; int *pData;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>};<br><br>Cont&amp; Cont::operator=(Cont&amp;&amp; rhs){<br>&nbsp; std::swap(pData, rhs.pData);<br>&nbsp; return *this;<br>}<i><br></i></div>
<div class="text"><b><a alt="%7B%22type%22%3A%22E%22%2C%22alias%22%3A%22%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-eq%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-eq%22%2C%22subject%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22target%22%3A%22_blank%22%2C%22version%22%3A1%2C%22anchor%22%3A%22%22%2C%22text%22%3A%22C.86%3A%20Make%20%3D%3D%20symmetric%20with%20respect%20of%20operand%20types%20and%20noexcept%22%2C%22ir_link%22%3A1%7D" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-eq" class="" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-eq">C.86: Make == symmetric with respect of operand types and noexcept</a></b></div>
<div class="text">Wer seine Anwender nicht überraschen will, sollte den <i>== operator</i> symmetrisch implementieren. In dem folgenden Beispiel kommt ein unintuitiver <i>== operator</i> zum Einsatz, der innerhalb der Klasse definiert ist. <br></div>
<div class="pre">class MyNumber {<br>&nbsp;&nbsp;&nbsp; int num;<br>public:<br>&nbsp;&nbsp;&nbsp; MyNumber(int n): num(n){};<br>&nbsp;&nbsp;&nbsp; bool operator==(const MyNumber&amp; rhs) const { return num == rhs.num; }<br>};<br><br>int main(){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MyNumber(5) == 5;<br>&nbsp;&nbsp;&nbsp; // 5 == MyNumber(5);<br>}</div>
<div class="text">Der Aufruf <i>MyNumber(5) == 5</i> ist gültig, da der Konstruktor sein <i>int-</i>Argument in eine Instanz von <i>MyNumber </i>konvertiert. Die letzte Zeile hingegen gibt eine Fehlermeldung. Der Vergleichsoperator von natürlichen Zahlen nimmt kein Argument vom Datentyp <i>MyNumber</i> an. </div>
<div class="text">Die elegante Art die Asymmetrie zu lösen, ist den <i>== operator </i>in der Klasse als <i>friend </i>zu deklarieren. Hier ist die zweite Variante von <i>MyNumber</i>.</div>
<div class="pre">class MyNumber {<br>&nbsp;&nbsp;&nbsp; int num;<br>public:<br>&nbsp;&nbsp;&nbsp; MyNumber(int n): num(n){};<br>&nbsp;&nbsp;&nbsp; bool operator==(const MyNumber&amp; rhs) const { return num == rhs.num; }<br>&nbsp;&nbsp;&nbsp; friend bool operator==(const int&amp; lhs, const MyNumber&amp; rhs){ <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return lhs == rhs.num; <br>&nbsp;&nbsp;&nbsp; }<br>};<br><br>int main(){<br>&nbsp;&nbsp;&nbsp; MyNumber(5) == 5;<br>&nbsp;&nbsp;&nbsp; 5 == MyNumber(5);<br>}</div>
<div class="text">Die Überraschungen gehen weiter.<br></div>
<div class="text"><b><a alt="%7B%22anchor%22%3A%22%22%2C%22text%22%3A%22C.87%3A%20Beware%20of%20%3D%3D%20on%20base%20classes%22%2C%22ir_link%22%3A1%2C%22version%22%3A1%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-eq-base%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-eq-base%22%2C%22alias%22%3A%22%22%2C%22target%22%3A%22_blank%22%2C%22subject%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22user_params%22%3A%22%22%7D" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-eq-base" class="" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-eq-base">C.87: Beware of == on base classes</a></b></div>
<div class="text">Das Schreiben eines narrensicheren <i>== operator</i> für Typhierarchien es ein sehr anspruchsvoller Job. Die Guidelines geben ein Beispiel dafür, was alles schiefgehen kann. Hier ist die Typhierarchie:</div>
<div class="pre">class B {<br>&nbsp;&nbsp;&nbsp; string name;<br>&nbsp;&nbsp;&nbsp; int number;<br>&nbsp;&nbsp;&nbsp; virtual bool operator==(const B&amp; a) const<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return name == a.name &amp;&amp; number == a.number;<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; // ...<br>};<br><br>class D :B {<br>&nbsp;&nbsp;&nbsp; char character;<br>&nbsp;&nbsp;&nbsp; virtual bool operator==(const D&amp; a) const<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return name == a.name &amp;&amp; number == a.number &amp;&amp; character == a.character;<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; // ...<br>};<br></div>
<div class="text">Probieren geht über Studieren.</div>
<div class="pre">B b = ...<br>D d = ...<br>b == d;&nbsp;&nbsp; // compares name and number, ignores d's character&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // (1)<br>d == b;&nbsp;&nbsp; // error: no == defined&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // (2)&nbsp; <br>D d2;<br>d == d2;&nbsp; // compares, name, number, and character<br>B&amp; b2 = d2; <br>b2 == d;&nbsp; // compares name and number, ignores d2's and d's character // (1)</div>
<div class="text">Vergleiche von Instanzen vom Typ <i>B </i>oder vom Typ <i>D </i>verhalten sich anständig. Werden die beiden Datentypen bei Vergleichen aber gemischt, geht die Überraschung los. Falls <i>B</i>s <i>== operator </i>verwendet wird, wird<i> D</i>s character (1) ignoriert. Falls <i>D</i>s<i> == operator</i> verwendet wird, schlägt der Vergleich für Instanzen von <i>B </i>fehl (3). Die letzte Zeile ist ziemlich trickreich. Der <i>== operator</i> von <i>B </i>wird eingesetzt. Warum? Der <i>== operator </i>von <i>D</i> überschreibt doch den <i>== operator</i> von <i>B.</i> Wirklich? Nein! Beide Operatoren haben verschiedene Signaturen. Einer bekommt eine Instanz von B, der andere Operator eine Instanz von D. Das heißt insbesondere, dass <i>D</i>s Version nicht <i>B</i>s Version überschreibt.</div>
<div class="text">Diese Beobachtungen gelten auch für die verbleibenden fünf Vergleichsoperatoren: <i>!=, &lt;, &lt;=,</i> and <i>&gt;=. </i></div>
<div class="text"><b><a class="" href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-hash" alt="%7B%22version%22%3A1%2C%22anchor%22%3A%22%22%2C%22ir_link%22%3A1%2C%22text%22%3A%22C.89%3A%20Make%20a%20hash%20noexcept%22%2C%22alias%22%3A%22%22%2C%22type%22%3A%22E%22%2C%22href%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-hash%22%2C%22destination%22%3A%22http%3A%2F%2Fisocpp.github.io%2FCppCoreGuidelines%2FCppCoreGuidelines%23Rc-hash%22%2C%22subject%22%3A%22%22%2C%22user_params%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22target%22%3A%22_blank%22%7D" title="Link auf http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-hash">C.89: Make a hash noexcept</a></b></div>
<div class="text">Hashfunktionen werden implizit von ungeordneten assoziativen Containern wie <i>std::unordered_map </i>verwendet. Der Anwender erwartet einfach nicht, dass diese eine Ausnahme werfen. Wer einen eigenen Datentyp als Schlüssel in einem ungeordneten assoziativen Container verwenden will, muss die Hashfunktion für den Schlüssel definieren.</div>
<div class="text">Dafür implementiert man die [i]hash[/i]-Funktion, indem man die [i]std::hash[/i]-Funktion auf die Attribute einer Klasse anwendet und deren Werte mit [i]^ (xor)[/i] kombiniert.</div>
<div class="pre">struct MyKey{<br>&nbsp; int valInt = 5;<br>&nbsp; double valDou = 5.5;<br>};<br><br>struct MyHash{<br>&nbsp; std::size_t operator()(MyKey m) const {<br>&nbsp;&nbsp;&nbsp; std::hash&lt;int&gt; hashVal1;<br>&nbsp;&nbsp;&nbsp; std::hash&lt;double&gt; hashVal2;<br>&nbsp;&nbsp;&nbsp; return hashVal1(m.valInt) ^ hasVal2(m.valDoub);<br>&nbsp; }<br>};</div>
<div class="ztitel">Wie geht's weiter?</div>
<div class="text">Gemäß den Guidelines sollte das nächste Themen Container und andere Ressource-Handle sein. Aber in den Guidelines gibt es erst die Überschrift zu den Regeln, daher werde ich diese Regeln überspringen und mich direkt auf die Lambda-Ausdrücke stürzen. </div>
<div class="ztitel">Weitere Informationen</div>
<div class="text"><ul><li>Funktionen anfordern und unterdrücken mit <i>default</i> und <i>delete:</i> <a alt="%7B%22anchor%22%3A%22%22%2C%22text%22%3A%22Automatik%20mit%20Methode%22%2C%22ir_link%22%3A1%2C%22version%22%3A1%2C%22target%22%3A%22_blank%22%2C%22subject%22%3A%22%22%2C%22custom%22%3A%7B%7D%2C%22user_params%22%3A%22%22%2C%22destination%22%3A%22http%3A%2F%2Fwww.linux-magazin.de%2FAusgaben%2F2014%2F08%2FC-11%22%2C%22type%22%3A%22E%22%2C%22alias%22%3A%22%22%2C%22href%22%3A%22http%3A%2F%2Fwww.linux-magazin.de%2FAusgaben%2F2014%2F08%2FC-11%22%7D" href="http://www.linux-magazin.de/Ausgaben/2014/08/C-11" class="" title="Link auf http://www.linux-magazin.de/Ausgaben/2014/08/C-11">Automatik mit Methode</a> (freier Artikel für das Linux-Magazin) </li></ul></div>
